import{a as R,b as W,c as q,d as L,e as U}from"./chunk-M334WHHZ.js";import{B as h,C as E,D as P,E as M,F as y,G as o,H as a,I as V,J as m,K as p,L as C,M as f,N as G,O as c,P as k,Q as i,R as b,S as g,T as F,U as $,V as N,W as z,Z as A,_ as j,ca as w,ea as Q,j as v,ja as I,k as u,l as _,n as x,s as D,t as s,w as O}from"./chunk-6NFFM5TD.js";var X=(t,n)=>n.utilisateur;function Y(t,n){if(t&1&&(m(0,"tr")(1,"td"),i(2),p(),m(3,"td"),i(4),p(),m(5,"td")(6,"strong"),i(7),p()()()),t&2){let e,r=n.$implicit,l=n.$index,d=c();k("highlight",r.utilisateur===((e=d.api.user())==null?null:e.email)),s(2),g("#",l+1),s(2),b(r.utilisateur),s(3),g("",r.score," pts")}}function Z(t,n){t&1&&(m(0,"tr")(1,"td",3),i(2,"Aucun score enregistr\xE9 pour le moment."),p()())}var T=class t{api=v(I);participants=j([]);onQuitter=A();get sortedParticipants(){return[...this.participants()].sort((n,e)=>e.score-n.score)}quitterPartie(){this.onQuitter.emit()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=O({type:t,selectors:[["app-classement"]],inputs:{participants:[1,"participants"]},outputs:{onQuitter:"onQuitter"},decls:18,vars:1,consts:[[1,"ranking-card"],[3,"highlight"],[3,"click"],["colspan","3"]],template:function(e,r){e&1&&(m(0,"div",0)(1,"h3"),i(2,"\u{1F3C6} Classement de la session"),p(),m(3,"table")(4,"thead")(5,"tr")(6,"th"),i(7,"Rang"),p(),m(8,"th"),i(9,"Joueur"),p(),m(10,"th"),i(11,"Score Total"),p()()(),m(12,"tbody"),P(13,Y,8,5,"tr",1,X,!1,Z,3,0,"tr"),p()(),m(16,"button",2),G("click",function(){return r.quitterPartie()}),i(17,"Retour aux \xC9choppes"),p()()),e&2&&(s(13),M(r.sortedParticipants))},dependencies:[w],encapsulation:2})};var ee=(t,n)=>n.nom,te=(t,n)=>n.utilisateur;function ne(t,n){if(t&1&&(o(0,"div",9)(1,"span"),i(2),a(),o(3,"span"),i(4),a()()),t&2){let e=c(),r=e.$implicit,l=e.$index;s(2),F("",l+1,". ",r.utilisateur.split("@")[0]),s(2),g("",r.score," PO")}}function ie(t,n){if(t&1&&h(0,ne,5,3,"div",9),t&2){let e=n.$index;E(e<3?0:-1)}}function oe(t,n){t&1&&(o(0,"div",8),i(1,"Aucune transaction enregistr\xE9e..."),a())}function ae(t,n){if(t&1){let e=C();o(0,"div",4)(1,"div",5),f("click",function(l){let d=u(e).$implicit,S=c(2);return l.stopPropagation(),_(S.rejoindre(d))}),o(2,"strong"),i(3),a(),o(4,"small"),i(5),a()(),o(6,"div",6)(7,"p",7),i(8,"\u{1F3C6} Top Marchands"),a(),P(9,ie,1,1,null,null,te,!1,oe,2,0,"div",8),a()()}if(t&2){let e=n.$implicit,r=c(2);s(3),b(e.nom),s(2),g("\u{1F4DC} \xC9choppe de ",e.createur),s(4),M(e.participants.sort(r.sortParticipants))}}function re(t,n){if(t&1&&(o(0,"div",1)(1,"h2"),i(2,"\u{1F4DC} \xC9choppes disponibles"),a(),o(3,"div",3),P(4,ae,12,3,"div",4,ee),a()()),t&2){let e=c();s(4),M(e.availableSessions())}}function se(t,n){if(t&1){let e=C();o(0,"div",16)(1,"input",18),z("ngModelChange",function(l){u(e);let d=c(3);return N(d.guess,l)||(d.guess=l),_(l)}),a(),o(2,"button",19),f("click",function(l){u(e);let d=c(3);return l.stopPropagation(),_(d.valider())}),i(3,"Sceller mon offre"),a()()}if(t&2){let e=c(3);s(),$("ngModel",e.guess),s(),y("disabled",!e.guess())}}function le(t,n){if(t&1){let e=C();o(0,"div",17)(1,"p"),i(2,"Valeur r\xE9elle : "),o(3,"strong"),i(4),a()(),o(5,"p"),i(6,"Points obtenus : "),o(7,"strong"),i(8),a()(),o(9,"button",20),f("click",function(l){u(e);let d=c(3);return l.stopPropagation(),_(d.suivant())}),i(10,"Objet suivant"),a()()}if(t&2){let e=c(3);s(4),g("",e.feedback().prixReel," PO"),s(4),b(e.feedback().pointsObtenus)}}function ce(t,n){if(t&1&&(o(0,"div",11)(1,"h3"),i(2),a(),o(3,"div",14),V(4,"img",15),a(),h(5,se,4,2,"div",16)(6,le,11,2,"div",17),a()),t&2){let e=c(2);s(2),b(e.session().produits[e.currentIndex()].nom),s(2),y("src",e.session().produits[e.currentIndex()].url,D)("alt",e.session().produits[e.currentIndex()].nom),s(),E(e.feedback()?6:5)}}function de(t,n){if(t&1){let e=C();o(0,"div",11)(1,"h2"),i(2,"Qu\xEAte termin\xE9e !"),a(),o(3,"p"),i(4,"Votre expertise a \xE9t\xE9 enregistr\xE9e dans le registre de la guilde."),a(),o(5,"button",20),f("click",function(l){u(e);let d=c(2);return l.stopPropagation(),_(d.session.set(null))}),i(6,"Retour aux \xE9choppes"),a()()}}function me(t,n){if(t&1){let e=C();o(0,"div",2)(1,"div",10),h(2,ce,7,4,"div",11)(3,de,7,0,"div",11),a(),o(4,"div",12)(5,"app-classement",13),f("onQuitter",function(){u(e);let l=c();return _(l.session.set(null))}),a()()()}if(t&2){let e=c();s(2),E(e.currentIndex()<4?2:3),s(3),y("participants",e.session().participants)}}var B=class t{http=v(Q);api=v(I);availableSessions=x([]);session=x(null);currentIndex=x(0);guess=x(null);feedback=x(null);ngOnInit(){this.loadAllSessions()}loadAllSessions(){this.http.get("http://localhost:3000/sessions").subscribe(n=>{this.availableSessions.set(n)})}rejoindre(n){this.session.set(n);let e=localStorage.getItem(`progress_${n.nom}`);e&&this.currentIndex.set(parseInt(e))}valider(){let n=this.api.user(),e=this.session();if(n&&e){let r={email:n.email,prixPropose:this.guess(),index:this.currentIndex()};this.http.post(`http://localhost:3000/sessions/${e.nom}/reponse`,r).subscribe(l=>{this.feedback.set(l),this.http.get("http://localhost:3000/sessions").subscribe(d=>{this.availableSessions.set(d);let S=d.find(H=>H.nom===e.nom);S&&this.session.set(S)})})}}suivant(){let n=this.currentIndex()+1;this.currentIndex.set(n),localStorage.setItem(`progress_${this.session().nom}`,n.toString()),this.feedback.set(null),this.guess.set(null)}sortParticipants(n,e){return e.score-n.score}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=O({type:t,selectors:[["app-game"]],decls:3,vars:3,consts:[[1,"container"],[1,"card","selection-card"],[1,"game-layout"],[1,"session-grid"],[1,"session-container"],[1,"session-item",3,"click"],[1,"mini-ranking"],[1,"rank-title"],[1,"empty-msg"],[1,"mini-score"],[1,"game-core"],[1,"card"],[1,"game-sidebar"],[3,"onQuitter","participants"],[1,"image-container"],[3,"src","alt"],[1,"input-group"],[1,"feedback-box"],["type","number","placeholder","Estimation (PO)",3,"ngModelChange","ngModel"],[3,"click","disabled"],[3,"click"]],template:function(e,r){e&1&&(o(0,"div",0),h(1,re,6,0,"div",1)(2,me,6,2,"div",2),a()),e&2&&(k("game-active",r.session()),s(),E(r.session()?2:1))},dependencies:[w,U,R,L,W,q,T],styles:['@charset "UTF-8";.game-layout[_ngcontent-%COMP%]{max-width:1100px;margin:30px auto;display:grid;grid-template-columns:1fr 350px;gap:30px;padding:0 20px;align-items:start}.game-core[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{text-align:center;min-height:550px;display:flex;flex-direction:column;justify-content:space-between}.game-core[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:20px;color:#3e2723}.game-core[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{position:relative;margin:30px auto;padding:20px;background:#0000000d;border:2px solid #8d6e63;border-radius:8px;box-shadow:inset 0 0 30px #0000001a;max-width:fit-content;display:flex;align-items:center;justify-content:center}.game-core[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:50%;width:130%;height:130%;background:radial-gradient(circle,rgba(212,175,55,.25) 0%,transparent 70%);transform:translate(-50%,-50%);z-index:0;pointer-events:none}.game-core[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;max-width:100%;max-height:350px;height:auto;object-fit:contain;border-radius:4px;position:relative;z-index:1;filter:drop-shadow(0 15px 20px rgba(0,0,0,.6));transition:transform .6s cubic-bezier(.175,.885,.32,1.275)}.game-core[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.08) rotate(3deg)}.game-sidebar[_ngcontent-%COMP%]{position:sticky;top:85px;z-index:10}.game-sidebar[_ngcontent-%COMP%]   .ranking-card[_ngcontent-%COMP%]{padding:1.5rem}.game-sidebar[_ngcontent-%COMP%]   .ranking-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.3rem}.game-sidebar[_ngcontent-%COMP%]   .ranking-card[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 5px;font-size:.95rem}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px;margin-top:20px}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;font-size:1.8rem;letter-spacing:3px;background:#fff;border:3px solid #5d4037;color:#1a0f0a}.feedback-box[_ngcontent-%COMP%]{background:#0000000d;padding:25px;border-radius:8px;border:2px solid #d4af37;margin-top:20px;animation:magicPulse 2s infinite alternate}.feedback-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.3rem;margin:12px 0}.feedback-box[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#5d4037;font-size:1.5rem}@media(max-width:950px){.game-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.game-sidebar[_ngcontent-%COMP%]{position:static}}']})};export{B as GameComponent};
